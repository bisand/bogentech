services:

  bogentech-web:
    image: bisand/bogentech-web:latest
    volumes:
      # Data persistency
      - /mnt/docker/bogentech/web/config:/app/config
      - /mnt/docker/bogentech/web/logs:/app/logs
    restart: always
    networks:
      - 'backend-network'
      - 'internal'
    environment:
      - NUXT_SESSION_PASSWORD=${NUXT_SESSION_PASSWORD}

      - NUXT_KINDE_PASSWORD=${NUXT_KINDE_PASSWORD}
      - NUXT_KINDE_CLIENT_ID=${NUXT_KINDE_CLIENT_ID}
      - NUXT_KINDE_CLIENT_SECRET=${NUXT_KINDE_CLIENT_SECRET}
      - NUXT_KINDE_AUTH_DOMAIN=${NUXT_KINDE_AUTH_DOMAIN}
      - NUXT_KINDE_REDIRECT_URL=${NUXT_KINDE_REDIRECT_URL}
      - NUXT_KINDE_LOGOUT_REDIRECT_URL=${NUXT_KINDE_LOGOUT_REDIRECT_URL}
      - NUXT_KINDE_POST_LOGIN_REDIRECT_URL=${NUXT_KINDE_POST_LOGIN_REDIRECT_URL}
    deploy:
      mode: replicated
      replicas: 3

  bogentech-redis:
    image: redis:latest
    networks:
      - 'internal'
    restart: always
    deploy:
      mode: replicated
      replicas: 1


networks:
  internal:
    driver: overlay
    internal: true
  backend-network:
    external: true
